# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

## [0.2.0] - 2026-01-27

### Added
- **Adapter Pattern Completion**: InfoAdapter implementation across all API versions (v0.0.40-v0.0.44)
  - Complete InfoManager with real API calls (Get, Ping, PingDatabase, Stats, Version)
  - Proper error handling and type conversions for all versions
  - Eliminated hybrid wrapper/adapter approach in v0.0.44
- **Standalone Operations**: Full support for standalone SLURM operations (v0.0.40/v0.0.42)
  - Licenses management
  - TRES (Trackable RESources)
  - Shares
  - Diagnostics
- **New Adapters**: Additional resource management for v0.0.40
  - WCKeyAdapter - WCKey management
  - ClusterAdapter - Cluster management
- **v0.0.42 Adapter Completion**: Full standalone feature implementation (#69)
  - Licenses adapter with proper field mapping
  - TRES adapter with complete type conversions
  - Shares adapter with fairshare calculations
  - Diagnostics adapter with 19 diagnostic fields
  - Accounts, Users, Associations adapters
  - WCKey and Cluster adapters
- **Public API Enhancement**: Exposed WithUseAdapters() option (#69)
  - Allows users to opt-in to adapter pattern for all versions
  - Provides choice between wrapper and adapter implementations
- **Linting Infrastructure**: Comprehensive code quality governance
  - goheader configuration for SPDX Apache-2.0 license enforcement
  - depguard rules for deprecated packages
  - Documented staticcheck exclusions with violation counts
  - Refined gosec exclusions with path-based rules
  - Enabled revive linter with 3-phase rollout (40+ rules)
  - Enabled errcheck type assertion checks
  - Enabled intrange linter for Go 1.22+ improvements
  - Enabled unparam linter with strategic exclusions
  - Enabled noctx and forcetypeassert linters
  - Enabled contextcheck, usetesting, dupword, and exhaustive
- **Documentation**: MkDocs Material site with autogenerated CLI and changelog
- **Release Infrastructure**:
  - GoReleaser configuration for automated releases
  - SECURITY.md with security policy and vulnerability reporting
  - RELEASE.md with detailed release process documentation
  - Automated release workflow triggered by git tags

### Changed
- **Architecture**: Removed hybrid wrapper/adapter approach from v0.0.44
  - AdapterClient no longer creates dual clients internally
  - Factory properly delegates Info() to adapter.GetInfoManager()
  - Added type converters between types.* and interfaces.*
- **Code Quality**: Reduced cyclomatic complexity thresholds from 50 to 25 to 20
  - Extracted helper methods across multiple adapters
  - Improved code readability and maintainability
- **Test Thresholds**: Adjusted platform-specific performance thresholds
  - Windows performance test threshold increased from 10% to 20% for CI variability

### Fixed
- **Critical Nil Pointer Bugs**: Fixed 14 nil pointer dereference vulnerabilities in adapter methods (#71)
  - Added nil checks to all 10 List methods (Jobs, Nodes, Partitions, QoS, Accounts, Users, Reservations, Associations, Clusters, WCKeys)
  - Added nil checks to 4 Get methods (Info, Reservation, Association, WCKey)
  - Prevents segfaults when adapters return nil results (e.g., auth failures)
  - Returns empty lists or ErrorCodeResourceNotFound instead of crashing
  - Critical fix for slurm-exporter and other observability tools
- **Test Stability**: Fixed flaky macOS CI tests (#70)
  - Skip analytics overhead compliance tests on macOS due to timing inconsistencies
  - Tests were randomly failing different subtests (utilization, efficiency, performance)
  - macOS runners have variable scheduling and thermal throttling
  - Tests continue running on Linux/Windows where timing is stable
- **Code Quality**: Fixed 7 cyclomatic complexity violations by extracting helper methods
  - v0.0.40-42: InfoAdapter.Stats() reduced from complexity 25 to 6
  - v0.0.43-44: InfoAdapter.Get() reduced from 21 to 7, Stats() reduced from 26 to 7
- **Type Conversions**: Fixed 4 unnecessary type conversion warnings (unconvert)
  - Removed redundant string() and int64() casts
- **Linter Violations**: Fixed 58 unparam violations across all API versions
  - Removed unused error returns from adapter converters
  - Removed unused parameters from API managers
- **Unused Code**: Fixed unused append operations in adapters (SA4010)
- **Gocritic**: Fixed nestingReduce violations and removed text exclusions
- **Module Tidiness**: Updated go.mod/go.sum for cmd/slurm-cli and examples
- **CI Failures**: Resolved staticcheck and gosec warnings
  - Fixed unused linter directives
  - Added safe integer overflow checks

## [0.1.0] - 2026-01-20

### Added
- **CI/CD Infrastructure**: GitHub Actions workflows for comprehensive testing
  - Multi-version Go testing (1.21, 1.22, 1.23)
  - Cross-platform testing (Linux, macOS, Windows)
  - Security scanning (gosec, govulncheck, CodeQL)
  - Dependency review and license compliance
  - Documentation generation and validation
- **Test Infrastructure**: Comprehensive test suite with mock server
  - Version-specific mock handler generation (v0.0.40-v0.0.44)
  - Integration tests covering all API versions
  - Performance benchmarks with platform-specific thresholds
  - Mock builder smoke tests
- **Documentation**: Comprehensive migration and setup guides
  - MIGRATION.md with version upgrade paths
  - Enhanced README with setup instructions
  - API documentation for jobs, nodes, and partitions
- **Code Quality**: Linting and code analysis tools
  - golangci-lint with comprehensive rule set
  - gosec security scanner configuration
  - cspell for documentation spell-checking
  - License header compliance checks
- **API Support**: Full support for SLURM REST API v0.0.44 (SLURM 25.11.0)
  - Complete adapter implementation for all resource managers
  - Comprehensive test coverage with 100% passing tests
  - Type-safe conversions between v0.0.44 API types and common types
  - Error handling with status code inclusion in error messages
  - Validation for all CRUD operations

### Changed
- **Architecture**: Refactored interfaces to dedicated package
  - Moved all interface definitions to `interfaces` package
  - Improved code organization and modularity
  - Prevented import cycles
- **Test Organization**: Moved test helpers to `*_test.go` files
  - Resolved import cycle issues
  - Improved test package isolation
- **API Version Support**: Updated multi-version support range from v0.0.40-v0.0.43 to v0.0.40-v0.0.44
- **Error Messages**: Enhanced error adapter to include status codes (404, 409, 500) in error messages
- **Ignore Patterns**: Improved .gitignore patterns for temporary files and reports

### Fixed
- **Critical Bugs**: Resolved panics and nil pointer dereferences
  - v0.0.41 PartitionManager nil client checks
  - v0.0.41 InfoManager nil client checks
  - Divide-by-zero in job step task generation
  - Nil pointer in resource trends with empty time series
- **API Issues**: Fixed routing and response handling
  - Analytics endpoint trailing slash compatibility
  - Dual route registration for `/jobs` endpoint
  - Response structure unwrapping in analytics tests
  - Query parameter naming (reference_job_id)
- **Error Handling**: Enhanced error classification
  - Proper deadline exceeded error handling
  - Network timeout error classification
  - Context deadline support in timeout tests
- **Test Reliability**: Platform-specific test adjustments
  - macOS performance test thresholds (80%)
  - Windows analytics overhead thresholds (10%)
  - Reduced flakiness on fast systems
- **Validation**: Improved consistency across adapters
  - Enhanced base manager validation
  - Consistent error messages across versions
  - Proper field mapping and type conversions
  - Case sensitivity issues in validation error messages
  - Type conversion for PartitionState in partition adapter
  - Empty update validation to require at least one field
  - Reservation validation to require both StartTime and EndTime

### Security
- **Dependency Updates**: Critical security patches
  - Updated kin-openapi from v0.128.0 to v0.133.0
  - Addressed CVE-2025-30153 in OpenAPI validation library
- **Security Infrastructure**: Automated vulnerability scanning
  - CodeQL analysis for Go code
  - Trivy container and dependency scanning
  - Nancy dependency vulnerability checks
  - OpenSSF Scorecard integration

---

## Version Support Matrix

| SLURM Version | REST API Version | Support Status |
|---------------|------------------|----------------|
| 25.11.0       | v0.0.44          | ✅ Supported    |
| 25.05.0       | v0.0.43          | ✅ Supported    |
| 24.11.0       | v0.0.42          | ✅ Supported    |
| 24.05.0       | v0.0.41          | ✅ Supported    |
| 23.11.0       | v0.0.40          | ✅ Supported    |

---

*For detailed changes, see the [commit history](https://github.com/jontk/slurm-client/commits/main).*
